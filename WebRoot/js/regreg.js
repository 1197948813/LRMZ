require(["tip"],function(a){function b(){function b(){var a=LIZI.check.isEmail,b=LIZI.check.isMobile;t.on("blur",function(){var d=$(this),e=d.val();return msg="",B=a(e)?"email":b(e)?"mobile":"",""==B?(D.a=!1,msg="��������ȷ��������ֻ��ע��",d.parent().addClass("params_error").removeClass("params_success"),d.parent().next().html("<em>"+msg+"</em>"),!1):("yes"==E[e]?(msg="",d.parent().addClass("params_success").removeClass("params_error"),l()):"no"==E[e]?(msg="email"==B?"������":"���ֻ����",msg+='�ѱ�ע�ᣬ<a href="/login/auth" style="color:#09f;text-decoration: underline;">ȥ��¼</a>��',d.parent().addClass("params_error").removeClass("params_success")):(msg="",d.next().addClass("loading_icon"),c(e)),void d.parent().next().html("<em>"+msg+"</em>"))})}function c(b){var c={};c.type=B,c.value=b,$.ajax({url:"/user/check_ifexists",type:"post",dataType:"json",data:c,success:function(a){t.next().removeClass("loading_icon"),"SUCCESS"==a.status?(D.a=!0,E[b]="yes",msg="",t.parent().addClass("params_success").removeClass("params_error"),l()):(D.a=!1,E[b]="no",msg=a.msg,t.parent().addClass("params_error").removeClass("params_success")),t.parent().next().html("<em>"+msg+"</em>")},error:function(b){D.a=!1,a.warn("������æ�����Ժ����ԡ�("+b.status+")")}})}function d(){w.on("click",function(){var b={};return w.hasClass("disabled")?!1:1>C?(a.warn("���ջ�ȡ������֤����������꣬����������"),!1):(b={mobile:t.val(),validate:A},w.parent().removeClass("params_error params_success"),void e(b))})}function e(b){$.ajax({url:"/user/ajax_sendMobileCode",type:"post",dataType:"json",data:b,success:function(b){if("SUCCESS"==b.status){var c="������֤���ѷ��ͣ���ע����ա�";w.addClass("disabled").text("�ٴη�����֤��(60)"),C=b.times,2>C&&(c+='<br>���ջ���<em style="color:#ff666b;">'+C+"</em>�η��ͻ��"),a.ok(c,function(){var a=60,b=setInterval(function(){0==a?(clearInterval(b),w.removeClass("disabled").text("��ȡ������֤��")):(a--,w.text("�ٴη�����֤��("+a+")"))},1e3)})}else w.removeClass("disabled").text("��ȡ������֤��"),a.warn(3==b.code?'���ֻ����ע�ᣬ��ֱ��<a href="#" style="color:#39f;text-decoration: underline;">��¼</a>��':b.msg)},error:function(b){w.removeClass("disabled").text("��ȡ������֤��"),a.warn("������æ�����Ժ����ԡ�("+b.status+")")}})}function f(){x.on("blur",function(){p(x)}),y.on("blur",function(){var a=x.val(),b=y.val();""!=a&&(b!=a?y.parent().addClass("params_error").removeClass("params_success").next().html("<em>�����������벻һ��</em>"):y.parent().addClass("params_success").removeClass("params_error").next().html("<em></em>"))})}function g(){var a=r.find("input[name='accept_lizi_law']")[0];z.on("click",function(){var b=$(this),c={};return _regName=t.val(),_pwd=x.val(),_pwd2=y.val(),_code=s.val(),b.find("img").length>0?!1:(""==_regName&&(D.a=!1,t.parent().addClass("params_error").removeClass("params_success").next().html("<em>������������ֻ��ע��</em>")),p(x),_pwd2!=_pwd&&(D.b=!1,y.parent().addClass("params_error").removeClass("params_success").next().html("<em>�����������벻һ��</em>")),_code.length<4&&(D.c=!1,s.parent().addClass("params_error").removeClass("params_success").next().html("<em>��������ȷ����֤��</em>")),D.a&&D.b&&D.c?a.checked?(b.html('<img src="../images/register/loading.gif" /> �ύ��'),c="email"==B?{email:_regName,password:_pwd,password_:_pwd2,code:_code}:{password:_pwd,password_:_pwd2},void h(c)):(b.parent().prev().html("<em>��ͬ�����ӷ���Э��</em>"),!1):!1)})}function h(b){var c="";c="mobile"==B?"/user/ajax_regMobile":"/user/ajax_regEmail",$.ajax({url:c,type:"post",data:b,dataType:"json",success:function(b){"SUCCESS"==b.status?location.href="/user/success":(z.html("ͬ��Э�鲢ע��"),a.warn(b.msg))},error:function(b){a.warn("������æ�����Ժ����ԡ�("+b.status+")")}})}function i(){var a=null;D.cStop=!1,s.on("keyup blur",function(){return D.cStop?!1:(null!==a&&clearTimeout(a),void(a=setTimeout(j,300)))})}function j(){var a=s.val();if(D.c=!1,""==B)return!1;if("mobile"==B){if(a.length<6||!LIZI.check.isInt(a))return!1}else if(a.length<4)return!1;s.parent().removeClass("params_error").removeClass("params_success").next().html("<em></em>"),k(a)}function k(b){var c="",d=s.parent();D.cStop=!0,d.find("span.error_icon").addClass("loading_icon"),c="mobile"==B?"/user/ajax_checkMobileCode":"/user/ajax_checkImageCode",$.ajax({url:c,type:"post",dataType:"json",data:{code:b},success:function(a){D.cStop=!1,"SUCCESS"==a.status?(D.c=!0,msg="",d.addClass("params_success").removeClass("params_error")):(msg=a.msg,d.addClass("params_error").removeClass("params_success")),d.find("span.error_icon").removeClass("loading_icon"),d.next().html("<em>"+msg+"</em>")},error:function(b){D.cStop=!1,a.warn("������æ�����Ժ����ԡ�("+b.status+")")}})}function l(){"mobile"==B?(u.hide(),v.hide(),w.css("visibility","visible"),s.prev("span.t_text").html("������֤��")):(u.show(),v.show(),w.css("visibility","hidden"),s.prev("span.t_text").html("��֤��"))}function m(){u.click(function(){u.attr("src","/user/checkImage?t="+Math.random()),u.parent().removeClass("params_error params_success").find("input[name=yzm]").val("").end().find("span.t_text").html("��֤��").show(),D.c=!1}),v.click(function(){u.trigger("click")}),u.trigger("click")}function n(){r.on("click","span.t_text",function(){$(this).hide().parent().find("input").focus()}).on("focus","input",function(){$(this).parent().find("span.t_text").hide()}).on("blur","input",function(){""==$.trim($(this).val())&&$(this).parent().find(".t_text").show()})}function o(){$("#left_pic").html('<img src="../images/register/login-box-bg.jpg" width="500" height="450" />')}function p(a){var b=a.val(),c=0;c=q(b),1>c?(a.parent().addClass("params_error").removeClass("params_success").next().html("<em>����������8λ�ַ������</em>"),D.b=!1):2>c?(a.parent().addClass("params_error").removeClass("params_success").next().html("<em>������(����/��Сд��ĸ/�����ַ�)����������ϵ�����</em>"),D.b=!1):(a.parent().addClass("params_success").removeClass("params_error").next().html("<em></em>"),D.b=!0)}function q(a){var b=0;return a.length<8?b:(/\d/.test(a)&&b++,/[a-z]/.test(a)&&b++,/[A-Z]/.test(a)&&b++,/\W/.test(a)&&b++,b)}var r=$("#register_box"),s=($("#sendtype"),r.find("input[name=yzm]")),t=r.find("input[name=register_name]"),u=$("#yzm"),v=$("#change"),w=$("#send_security_code"),x=r.find("input[name='psw']"),y=r.find("input[name='confirm_psw']"),z=r.find("a.submit_btn"),A=$("#validate").val(),B="",C=5,D={a:!1,b:!1,c:!1},E={};this.init=function(){o(),n(),m(),b(),f(),i(),g(),d()}}(new b).init()});