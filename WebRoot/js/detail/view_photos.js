define(["imagesloaded"],function(a){function b(b){b.on("click","li",function(){var b=$(this),c=b.data("src"),d=b.parent("ul").next(".viewer");if(void 0!=c)if(b.hasClass("current"))b.removeClass("current"),d.hide().off();else{b.addClass("current").siblings("li").removeClass("current"),d.off().on("click",function(){b.trigger("click")});var e=new Image;e.src=c,a($(e),function(){e.width>600&&(e.height=600*e.height/e.width,e.width=600),d.find("img").length>0?d.show().find("img").css({width:e.width,height:e.height}).attr("src",c):d.show().html('<img src="'+c+'" style="width:'+e.width+"px; height:"+e.height+'px;" />')})}})}return b});