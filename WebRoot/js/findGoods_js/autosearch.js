define(function(){function a(a){function b(a){var b=f.find("li"),c=b.length;if(c>0)switch(a.keyCode){case 40:j++,j>c-1&&(j=0),b.removeClass("on").eq(j).addClass("on"),m.val(b.eq(j).text());break;case 38:j--,0>j&&(j=c-1),b.removeClass("on").eq(j).addClass("on"),m.val(b.eq(j).text())}}function c(a){$.ajax({url:l.url,type:"post",data:{content:a},dataType:"json",success:function(b){"SUCCESS"==b.status&&(h[a]=b.words,d(a))}})}function d(a){var b="",c=h[a];c.length>0?($.each(c,function(a,c){b+="<li>"+c+"</li>"}),f.html("<ul>"+b+"</ul>").css({left:e.left,top:e.top,display:"block"}),j=-1):f.hide()}var e=null,f=null,g="",h={},i=null,j=-1,k={elem:null,url:"",initkey:"",placeholder:"请输入关键字"},l=$.extend(k,a),m=l.elem,n=m.closest("form");null!=m&&(g="search_result_"+n.attr("id"),f=$('<div id="'+g+'" class="search_result"></div>').appendTo("body"),m.attr("autocomplete","off").on("focus",function(){var a=$.trim(m.val());return""==a?!1:(e=m.offset(),a==l.placeholder?m.val(""):void 0!=h[a]?d(a):c(a),!1)}).on("keyup",function(a){40!=a.keyCode&&38!=a.keyCode&&13!=a.keyCode&&(clearTimeout(i),i=setTimeout(function(){var a=$.trim(m.val());void 0!=h[a]?d(a):c(a)},300))}).blur(function(){""==$.trim(m.val())&&m.val(l.placeholder)}).on("keydown",b),f.on("mouseenter","li",function(){var a=$(this);return j=a.index(),a.addClass("on").siblings("li").removeClass("on"),!1}).on("click","li",function(){m.val($(this).text()),setTimeout(function(){n.submit()},300)}),n.submit(function(){($.trim(m.val())==l.placeholder||""==$.trim(m.val()))&&m.val(l.initkey)}),$(document).on("click",function(a){a.target!==m[0]&&a.target!==f[0]&&f.hide()}))}return a});